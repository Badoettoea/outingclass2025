```html
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Rundown Eduwisata SDN BUNGO 3</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background-color: #f8f9fa;
    }

    .navbar-brand img {
      width: 50px;
    }

    .section-title {
      color: #2c3e50;
      font-weight: 700;
    }

    .card {
      margin-bottom: 20px;
    }

    .seat-map {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
    }

    .seat-map div {
      background-color: #e9ecef;
      padding: 10px;
      border-radius: 5px;
    }
  </style>
  <!-- Supabase CDN -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>

<body>
  <header>
    <div class="container text-center py-4">
      <img src="images/logo.png" alt="SDN BUNGO 3 Logo" class="img-fluid">
      <h1>Rundown Eduwisata</h1>
      <h2>SDN BUNGO 3</h2>
      <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
            aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav mx-auto">
              <li class="nav-item">
                <a class="nav-link" href="#ringkasan">Ringkasan</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#jadwal">Jadwal Kegiatan</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#lokasi">Lokasi</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#denah">Denah Duduk Bus</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="#pengacak">Pengacak Denah Duduk</a>
              </li>
            </ul>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main class="container my-5">
    <section id="ringkasan" class="mb-5">
      <div class="card">
        <div class="card-body">
          <h2 class="section-title">Ringkasan</h2>
          <p>
            Eduwisata SDN BUNGO 3 merupakan kegiatan khusus yang dirancang untuk memberikan siswa pengalaman edukatif dan
            menyenangkan di luar kelas. Kegiatan ini akan membantu siswa belajar tentang alam, kerja sama tim, dan budaya
            lokal sambil menikmati berbagai kegiatan yang direncanakan oleh guru dan staf.
          </p>
          <img src="images/children-playing.jpg" alt="Children Playing" class="img-fluid mt-3">
        </div>
      </div>
    </section>

    <section id="jadwal" class="mb-5">
      <h2 class="section-title">Jadwal Kegiatan</h2>
      <div class="card">
        <div class="card-body">
          <ul class="list-group list-group-flush">
            <li class="list-group-item">06:00 - 06:30 - Berkumpul di titik penjemputan bus, absensi, dan briefing
              kegiatan</li>
            <li class="list-group-item">06:30 - 09:30 - Perjalanan ke Watu Gajah (ice breaking di bus)</li>
            <li class="list-group-item">09:30 - 12:00 - Eksplorasi Watu Gajah:<br>
              - Batu Gajah (spot ikonik)<br>
              - Jembatan Kayu & Rumah Pohon<br>
              - Puncak Pandang (view 360°)<br>
              - Angel Wings (spot foto)</li>
            <li class="list-group-item">12:00 - 12:30 - ISOMA (makan siang lunch box)</li>
            <li class="list-group-item">12:30 - 13:30 - Perjalanan ke Saloka Theme Park</li>
            <li class="list-group-item">13:30 - 15:00 - Wahana Saloka:<br>
              - Taman Langit (sky bike)<br>
              - Dino Park (foto dengan dinosaurus)<br>
              - Pasar Setan (explore area horor)</li>
            <li class="list-group-item">15:00 - 15:30 - Sholat Ashar di mushala Saloka</li>
            <li class="list-group-item">15:30 - 17:30 - Lanjut wahana:<br>
              - Rajawali (roller coaster)<br>
              - Banjir Banda (water ride)<br>
              - Pohon Akrobat (untuk anak-anak)</li>
            <li class="list-group-item">17:30 - 18:00 - Persiapan menyaksikan Baru Klinting Show</li>
            <li class="list-group-item">18:00 - 18:45 - Nonton Baru Klinting Show (teater outdoor)</li>
            <li class="list-group-item">18:45 - 19:30 - Makan malam & beli merchandise</li>
            <li class="list-group-item">19:30 - 21:30 - Perjalanan pulang ke sekolah</li>
            <li class="list-group-item">21:30 - Sampai di sekolah, pembubaran</li>
          </ul>
        </div>
      </div>
    </section>

    <section id="lokasi" class="mb-5">
      <h2 class="section-title">Lokasi</h2>
      <div class="card">
        <div class="card-body">
          <p>
            Kegiatan ini akan dilaksanakan di Watu Gajah Park dan Saloka Theme Park, sebuah taman hiburan menarik yang
            menawarkan berbagai wahana dan atraksi. Area ini memiliki tanaman hijau yang rimbun, jalur pejalan kaki, dan
            ruang terbuka yang cocok untuk kegiatan belajar dan aktivitas luar ruangan.
          </p>
          <div class="row mt-3">
            <div class="col-md-6">
              <img src="images/watu-gajah.png" alt="Watu Gajah Park" class="img-fluid">
            </div>
            <div class="col-md-6">
              <img src="images/saloka.png" alt="Saloka Theme Park" class="img-fluid">
            </div>
          </div>
        </div>
      </div>
    </section>

    <section id="denah" class="mb-5">
      <h2 class="section-title">Denah Duduk Bus</h2>
      <div class="card">
        <div class="card-body">
          <h3>Bus 1 (50 Kursi)</h3>
          <div class="seat-map">
            <div>DEPAN - SOPIR</div>
            <div id="bus1"></div>
          </div>
          <h3 class="mt-4">Bus 2 (35 Kursi)</h3>
          <div class="seat-map">
            <div>DEPAN - SOPIR</div>
            <div id="bus2"></div>
          </div>
        </div>
      </div>
    </section>

    <section id="denah-duduk" class="mb-5">
      <h2 class="section-title">Denah Duduk</h2>
      <div class="card">
        <div class="card-body">
          <h3>Bus 1</h3>
          <table class="table">
            <thead>
              <tr>
                <th>No. Kursi</th>
                <th>Nama</th>
              </tr>
            </thead>
            <tbody id="bus1-table"></tbody>
          </table>
          <h3 class="mt-4">Bus 2</h3>
          <table class="table">
            <thead>
              <tr>
                <th>No. Kursi</th>
                <th>Nama</th>
              </tr>
            </thead>
            <tbody id="bus2-table"></tbody>
          </table>
        </div>
      </div>
    </section>

    <section id="pengacak" class="mb-5">
      <h2 class="section-title">Pengacak Denah Duduk</h2>
      <div class="card">
        <div class="card-body">
          <div class="mb-3">
            <label for="pin-input" class="form-label">Masukkan PIN (2 Angka)</label>
            <input type="text" class="form-control" id="pin-input" maxlength="2">
          </div>
          <button id="shuffle-button" class="btn btn-primary">Acak Kursi Saya</button>
        </div>
      </div>
    </section>

    <section id="kursi-info" class="mb-5">
      <h2 class="section-title">Kursi Info</h2>
      <div class="card">
        <div class="card-body">
          <div id="seat-info">Memuat data...</div>
          <button id="close-info" class="btn btn-secondary mt-3">Tutup</button>
        </div>
      </div>
    </section>
  </main>

  <footer class="text-center py-4">
    <p>© 2025 SDN BUNGO 3. All rights reserved.</p>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Inisialisasi Supabase
    const supabase = Supabase.createClient('https://creklruajbmewnozdbaj.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNyZWtscnVhamJtZXdub3pkYmFqIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgzNTkyMzgsImV4cCI6MjA2MzkzNTIzOH0._RTqclOq-w09r0KaZbqGLpPdT04IRwJtdDf-esJpTyc');

    // Fungsi untuk memperbarui tampilan denah duduk
    async function updateSeatDisplay() {
      const bus1Map = document.querySelector('#bus1');
      const bus2Map = document.querySelector('#bus2');
      const bus1Table = document.querySelector('#bus1-table');
      const bus2Table = document.querySelector('#bus2-table');
      bus1Map.innerHTML = '';
      bus2Map.innerHTML = '';
      bus1Table.innerHTML = '';
      bus2Table.innerHTML = '';

      const { data, error } = await supabase
        .from('seating')
        .select('bus, seat, student_name')
        .order('seat', { ascending: true });

      if (error) {
        console.error('Error fetching seating data:', error.message);
        bus1Map.innerHTML = 'Gagal memuat data!';
        bus2Map.innerHTML = 'Gagal memuat data!';
        return;
      }

      data.forEach(student => {
        if (student.bus && student.seat) {
          const seatInfo = `<div>${student.seat}: ${student.student_name}</div>`;
          const tableRow = `<tr><td>${student.seat}</td><td>${student.student_name}</td></tr>`;
          if (student.bus === 'Bus 1') {
            bus1Map.innerHTML += seatInfo;
            bus1Table.innerHTML += tableRow;
          } else if (student.bus === 'Bus 2') {
            bus2Map.innerHTML += seatInfo;
            bus2Table.innerHTML += tableRow;
          }
        }
      });
    }

    // Fungsi untuk menampilkan info kursi
    async function showSeatInfo() {
      const pin = document.querySelector('#pin-input').value;
      if (pin.length !== 2 || isNaN(pin)) {
        document.querySelector('#seat-info').innerHTML = 'PIN harus 2 angka!';
        return;
      }

      const { data, error } = await supabase
        .from('seating')
        .select('bus, seat, student_name')
        .eq('pin', pin)
        .single();

      if (error || !data) {
        document.querySelector('#seat-info').innerHTML = 'Data kursi tidak ditemukan!';
        return;
      }

      document.querySelector('#seat-info').innerHTML = 
        `Kursi: ${data.bus} - ${data.seat} (${data.student_name})`;
    }

    // Fungsi pengacakan kursi
    async personally significant to shuffleSeats() {
      const pin = document.querySelector('#pin-input').value;
      if (pin.length !== 2 || isNaN(pin)) {
        alert('PIN harus 2 angka!');
        return;
      }

      // Validasi PIN
      const { data: validPin, error: pinError } = await supabase
        .from('seating')
        .select('id')
        .eq('pin', pin)
        .single();
      if (pinError || !validPin) {
        alert('PIN tidak valid!');
        return;
      }

      // Ambil data dari Supabase
      const { data, error } = await supabase
        .from('seating')
        .select('id, student_name, gender, pair_with, is_parent, child_name');
      if (error) {
        console.error('Error fetching data:', error.message);
        alert('Gagal memuat data!');
        return;
      }

      // Definisikan kapasitas bus
      const bus1Seats = Array.from({ length: 50 }, (_, i) => ({ bus: 'Bus 1', seat: i + 1 }));
      const bus2Seats = Array.from({ length: 35 }, (_, i) => ({ bus: 'Bus 2', seat: i + 1 }));
      let availableSeats = [...bus1Seats, ...bus2Seats];

      // Acak kursi
      availableSeats = availableSeats.sort(() => Math.random() - 0.5);

      // Kelompokkan siswa berdasarkan pair_with dan is_parent/child_name
      const assignments = [];
      const processedIds = new Set();

      for (const student of data) {
        if (processedIds.has(student.id)) continue;

        const assignment = { id: student.id, bus: null, seat: null };

        // Cek apakah siswa harus dipasangkan
        if (student.pair_with || student.is_parent) {
          const pairedStudents = [student];
          if (student.pair_with) {
            const pair = data.find(s => s.student_name === student.pair_with);
            if (pair && !processedIds.has(pair.id)) pairedStudents.push(pair);
          }
          if (student.is_parent && student.child_name) {
            const child = data.find(s => s.student_name === student.child_name);
            if (child && !processedIds.has(child.id)) pairedStudents.push(child);
          }

          // Alokasikan kursi berdekatan untuk kelompok
          for (let i = 0; i < pairedStudents.length; i++) {
            if (availableSeats.length === 0) {
              alert('Kursi tidak cukup!');
              return;
            }
            assignments.push({
              id: pairedStudents[i].id,
              bus: availableSeats[0].bus,
              seat: availableSeats[0].seat,
            });
            processedIds.add(pairedStudents[i].id);
            availableSeats.shift();
          }
        } else {
          // Alokasikan kursi untuk siswa tunggal
          if (availableSeats.length === 0) {
            alert('Kursi tidak cukup!');
            return;
          }
          assignment.bus = availableSeats[0].bus;
          assignment.seat = availableSeats[0].seat;
          assignments.push(assignment);
          processedIds.add(student.id);
          availableSeats.shift();
        }
      }

      // Perbarui tabel di Supabase
      for (const assignment of assignments) {
        const { error } = await supabase
          .from('seating')
          .update({ bus: assignment.bus, seat: assignment.seat })
          .eq('id', assignment.id);
        if (error) {
          console.error('Error updating seat:', error.message);
          alert('Gagal memperbarui kursi!');
          return;
        }
      }

      // Perbarui tampilan denah duduk dan info kursi
      await updateSeatDisplay();
      await showSeatInfo();
    }

    // Event listener untuk tombol
    document.querySelector('#shuffle-button').addEventListener('click', shuffleSeats);
    document.querySelector('#close-info').addEventListener('click', () => {
      document.querySelector('#seat-info').innerHTML = 'Memuat data...';
      document.querySelector('#pin-input').value = '';
    });

    // Inisialisasi tampilan denah duduk saat halaman dimuat
    document.addEventListener('DOMContentLoaded', updateSeatDisplay);
  </script>
</body>

</html>
```
